# 监听地址与端口
bind-addr 0.0.0.0
bind-port 65353

# 上游 DNS（国内/可信）
# - china 组使用稳定的阿里和百度DNS
# - trust 组使用TCP DNS（通过V2Ray代理，端口53）
china-dns 223.5.5.5,223.6.6.6,180.76.76.76
trust-dns tcp://8.8.8.8,tcp://1.1.1.1,tcp://8.8.4.4

# 域名列表（纯域名分流：无 tag:none，不做 IP 测试）
chnlist-file /etc/chinadns-ng/chnlist.txt
gfwlist-file /etc/chinadns-ng/gfwlist.txt
chnlist-first
# 未命中任何列表时，默认按 chn 处理（走代理上游）
default-tag chn

# 启用 ipset 功能
# 收集 tag:chn 和 tag:gfw 域名的 IP 地址
add-tagchn-ip chnip,chnip6
add-taggfw-ip gfwip,gfwip6

# 可选：禁用黑名单功能
no-ipset-blacklist

# 本地 hosts（可选）
hosts

# 稳定性/性能
# DoT需要建立TLS连接，超时设为8秒
# 重复2次提升可靠性，避免单次网络抖动
timeout-sec 8
repeat-times 2

# DNS 缓存
cache 50000
cache-stale 3600
cache-refresh 30
cache-min-ttl 60
cache-max-ttl 86400
# 缓存持久化到容器内临时路径（重启容器会丢失）
cache-db /tmp/chinadns-cache.db

# 纯域名分流下无需 verdict-cache，如需切换回 tag:none 判定再启用
# verdict-cache 20000
# verdict-cache-db /tmp/chinadns-verdict.db

# 启用verbose日志用于调试
verbose