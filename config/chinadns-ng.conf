# 监听地址与端口
bind-addr 0.0.0.0
bind-port 65353

# 上游 DNS（国内/可信）
# - china 组使用多上游，取先返回者
# - trust 组强制 TCP，提升可靠性（避免 UDP 丢包）
china-dns 223.5.5.5,119.29.29.29,114.114.114.114
trust-dns tls://8.8.8.8,tls://1.1.1.1,tls://9.9.9.9

# 域名列表（纯域名分流：无 tag:none，不做 IP 测试）
chnlist-file /etc/chinadns-ng/chnlist.txt
gfwlist-file /etc/chinadns-ng/gfwlist.txt
chnlist-first
# 未命中任何列表时，默认按 chn 处理（走国内上游）
default-tag chn

# 启用 ipset 功能
# 使用官方默认的 ipset 集合名称
ipset-name4 chnroute
ipset-name6 chnroute6

# 收集 tag:chn 和 tag:gfw 域名的 IP 地址
add-tagchn-ip chnip,chnip6
add-taggfw-ip gfwip,gfwip6

# 可选：禁用黑名单功能
no-ipset-blacklist

# 本地 hosts（可选）
hosts

# 稳定性/性能
# 超时适度放宽，trust 走 TCP 后无需重复发包
timeout-sec 5
repeat-times 1

# DNS 缓存
cache 50000
cache-stale 3600
cache-refresh 30
cache-min-ttl 60
cache-max-ttl 86400
# 缓存持久化到容器内临时路径（重启容器会丢失）
cache-db /tmp/chinadns-cache.db

# 纯域名分流下无需 verdict-cache，如需切换回 tag:none 判定再启用
# verdict-cache 20000
# verdict-cache-db /tmp/chinadns-verdict.db